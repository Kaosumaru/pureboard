<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>reducer | pureboard</title><meta name="description" content="Documentation for pureboard"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">pureboard</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">pureboard</a></li><li><a href="reducer.html">reducer</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="reducer" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Reducer<a href="#reducer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="common-patterns" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common patterns<a href="#common-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="send-player-id-in-actions-related-to-player-and-validate-it" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Send player id in actions related to player, and validate it<a href="#send-player-id-in-actions-related-to-player-and-validate-it" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Since one user can take one or more seats, actions should specify which player is doing it.
Then, you should include something like this in your reducer:</p>
<pre><code class="ts"><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-6">playerValidation</span><span class="hl-1">.</span><span class="hl-0">canMoveAsPlayer</span><span class="hl-1">(</span><span class="hl-6">action</span><span class="hl-1">.</span><span class="hl-6">player</span><span class="hl-1">)) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Not your turn&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="validate-actions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validate Actions<a href="#validate-actions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Check for invalid input or moves in reducer</p>
<pre><code class="ts"><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">victoriousPlayer</span><span class="hl-1"> !== -</span><span class="hl-9">1</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Game is already over&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">column</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1"> || </span><span class="hl-6">column</span><span class="hl-1"> &gt;= </span><span class="hl-6">board</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-6">length</span><span class="hl-1">) </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid column&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="random-values" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Random values<a href="#random-values" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Reducer can use provided <code>RandomGenerator</code> to generate random numbers.
You CANNOT use Math.random, as then reducer wouldn't be pure, and every client would generate a different random number, leading to a desync.</p>
<pre><code class="ts"><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-6">action</span><span class="hl-1">.</span><span class="hl-6">type</span><span class="hl-1"> === </span><span class="hl-2">&quot;newGame&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">currentPlayer:</span><span class="hl-1"> </span><span class="hl-6">random</span><span class="hl-1">.</span><span class="hl-0">int</span><span class="hl-1">(</span><span class="hl-9">2</span><span class="hl-1">),</span><br/><span class="hl-1">        ...</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="hidden-state" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Hidden state<a href="#hidden-state" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can use <code>IHiddenObjects&lt;Type&gt;</code> to keep a store of hidden objects, which can be made visible to some players.</p>
<p>For example, you can create a hand of cards:</p>
<pre><code class="ts"><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">card</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-6">hand</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">objects</span><span class="hl-1">.</span><span class="hl-0">addObject</span><span class="hl-1">(</span><span class="hl-6">card</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">, </span><span class="hl-6">card</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1"> % </span><span class="hl-9">4</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-2">&#39;skull&#39;</span><span class="hl-1"> : </span><span class="hl-2">&#39;flower&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>To create a hidden store with ids that correspond to a string.</p>
<div class="tsd-alert tsd-alert-warning"><div class="tsd-alert-title"><svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="../assets/icons.svg#icon-alertWarning"></use></svg><span>Warning</span></div><p><br>
Remember that if a client saw value of given object, or if you are creating objects in predictable way
(like in this sample, <a href="http://card.id">card.id</a> = 0 will be always a skull)</p>
<p>You should make sure that ids are randomized so client can't infer what value is under given id - you can use shuffleAndHide method</p>
</div>
<p>This will will shuffle internal values of given array of ids</p>
<pre><code class="ts"><span class="hl-6">objects</span><span class="hl-1">.</span><span class="hl-0">shuffleAndHide</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">player</span><span class="hl-1">.</span><span class="hl-6">hand</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-6">card</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">card</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">visibleForPlayerId</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>So if you start with:</p>
<blockquote>
<p>0 -&gt; skull
1 -&gt; flower
2 -&gt; flower
3 -&gt; flower</p>
</blockquote>
<p>Calling <code>objects.shuffleAndHide([0,1,2,3], 0);</code></p>
<p>will hide these objects for all player except player 0, and will cause values of these objects to shuffle, so you can end with:</p>
<blockquote>
<p>0 -&gt; flower
1 -&gt; flower
2 -&gt; skull
3 -&gt; flower</p>
</blockquote>
<p>(or any other combination)</p>
<p>Clients will only get values of objects that are marked as visible for them, server keeps all these objects. If an action will cause an object to become visible for given client, data about it will be sent to that client together with that action.</p>
<p>Client can get info about value visible to him using <code>hiddenObjectsStore</code></p>
<pre><code class="ts"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-8">object</span><span class="hl-1"> = </span><span class="hl-6">props</span><span class="hl-1">.</span><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">hiddenObjectsStore</span><span class="hl-1">(</span><span class="hl-6">state</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">state</span><span class="hl-1">.</span><span class="hl-6">objects</span><span class="hl-1">[</span><span class="hl-6">props</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#reducer"><span>Reducer</span></a><ul><li><a href="#common-patterns"><span>Common patterns</span></a></li><li><ul><li><a href="#send-player-id-in-actions-related-to-player-and-validate-it"><span>Send player id in actions related to player, and validate it</span></a></li><li><a href="#validate-actions"><span>Validate <wbr/>Actions</span></a></li><li><a href="#random-values"><span>Random values</span></a></li><li><a href="#hidden-state"><span>Hidden state</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">pureboard</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/JulianWowra/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
